#!/bin/bash

# ANSI color codes
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m' # No Color
BOLD='\033[1m'

# Header
echo -e "┌───────────────────────────────────────────────────────────────────────────────────────────────────────┐"
echo -e "│ AI-Driven API Pentesting Platform - Results                                                           │"
echo -e "├───────────────────────────────────────────────────────────────────────────────────────────────────────┤"
echo -e "│ Target: api.securebank.com                                                                            │"
echo -e "│ Pentest Run: 2024-08-29 09:45:30 UTC                                                                  │"
echo -e "├───────────────────────────────────────────────────────────────────────────────────────────────────────┤"
echo -e "│ ID │ Endpoint                    │ Method │ Original │ Modified │ Status    │ Test Type               │"
echo -e "├───────────────────────────────────────────────────────────────────────────────────────────────────────┤"

echo -e "│ 1  │ /api/v1/auth/login          │ POST   │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Authentication          │"
echo -e "│ 2  │ /api/v1/users/me            │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Authenticated Access    │"
echo -e "│ 3  │ /api/v1/users/101/transact..│ GET    │ 403 Forb.│ 200 OK   │ ${RED}FAILED${NC}    │ Horiz. Priv. Escalation │"
echo -e "│ 4  │ /api/v1/transfers           │ POST   │ 201 Crea.│ 201 Crea.│ ${GREEN}PASSED${NC}    │ Transaction Security    │"
echo -e "│ 5  │ /api/v1/accounts/balance    │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Integrity          │"
echo -e "│ 6  │ /api/v1/admin/create_account│ POST   │ 403 Forb.│ 201 Crea.│ ${RED}FAILED${NC}    │ Vert. Priv. Escalation  │"
echo -e "│ 7  │ /api/v1/transactions/recent │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Privacy            │"
echo -e "│ 8  │ /api/v1/users/me/update     │ PUT    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Input Validation        │"
echo -e "│ 9  │ /api/v1/cards/list          │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Enumeration        │"
echo -e "│ 10 │ /api/v1/admin/users         │ GET    │ 403 Forb.│ 200 OK   │ ${RED}FAILED${NC}    │ Vert. Priv. Escalation  │"
echo -e "│ 11 │ /api/v1/payments/schedule   │ POST   │ 201 Crea.│ 201 Crea.│ ${GREEN}PASSED${NC}    │ Transaction Security    │"
echo -e "│ 12 │ /api/v1/notifications       │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Privacy            │"
echo -e "│ 13 │ /api/v1/settings/update     │ PUT    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Input Validation        │"
echo -e "│ 14 │ /api/v1/investments/portfol.│ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Integrity          │"
echo -e "│ 15 │ /api/v1/admin/system/config │ POST   │ 403 Forb.│ 403 Forb.│ ${GREEN}PASSED${NC}    │ Vert. Priv. Escalation  │"
echo -e "│ 16 │ /api/v1/loans/status        │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Privacy            │"
echo -e "│ 17 │ /api/v1/feedback            │ POST   │ 201 Crea.│ 201 Crea.│ ${GREEN}PASSED${NC}    │ Input Validation        │"
echo -e "│ 18 │ /api/v1/branches/nearby     │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Enumeration        │"
echo -e "│ 19 │ /api/v1/profile/picture     │ PUT    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ File Upload Security    │"
echo -e "│ 20 │ /api/v1/reports/annual      │ GET    │ 403 Forb.│ 403 Forb.│ ${GREEN}PASSED${NC}    │ Vert. Priv. Escalation  │"
echo -e "│ 21 │ /api/v1/currency/exchange   │ POST   │ 201 Crea.│ 201 Crea.│ ${GREEN}PASSED${NC}    │ Transaction Security    │"
echo -e "│ 22 │ /api/v1/statements/list     │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Privacy            │"
echo -e "│ 23 │ /api/v1/password/update     │ PUT    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Authentication          │"
echo -e "│ 24 │ /api/v1/promotions/active   │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Enumeration        │"
echo -e "│ 25 │ /api/v1/admin/announcements │ POST   │ 403 Forb.│ 403 Forb.│ ${GREEN}PASSED${NC}    │ Vert. Priv. Escalation  │"
echo -e "│ 26 │ /api/v1/atms/locations      │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Enumeration        │"
echo -e "│ 27 │ /api/v1/support/ticket      │ POST   │ 201 Crea.│ 201 Crea.│ ${GREEN}PASSED${NC}    │ Input Validation        │"
echo -e "│ 28 │ /api/v1/insurance/policies  │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Privacy            │"
echo -e "│ 29 │ /api/v1/notif/preferences   │ PUT    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Input Validation        │"
echo -e "│ 30 │ /api/v1/admin/logs          │ GET    │ 403 Forb.│ 403 Forb.│ ${GREEN}PASSED${NC}    │ Vert. Priv. Escalation  │"
echo -e "│ 31 │ /api/v1/investments/trade   │ POST   │ 201 Crea.│ 201 Crea.│ ${GREEN}PASSED${NC}    │ Transaction Security    │"
echo -e "│ 32 │ /api/v1/credit-score        │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Privacy            │"
echo -e "│ 33 │ /api/v1/account/nickname    │ PUT    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Input Validation        │"
echo -e "│ 34 │ /api/v1/rewards/points      │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Integrity          │"
echo -e "│ 35 │ /api/v1/admin/user/suspend  │ POST   │ 403 Forb.│ 403 Forb.│ ${GREEN}PASSED${NC}    │ Vert. Priv. Escalation  │"
echo -e "│ 36 │ /api/v1/cards/limits        │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Privacy            │"
echo -e "│ 37 │ /api/v1/beneficiaries/add   │ POST   │ 201 Crea.│ 201 Crea.│ ${GREEN}PASSED${NC}    │ Input Validation        │"
echo -e "│ 38 │ /api/v1/transactions/categ. │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Enumeration        │"
echo -e "│ 39 │ /api/v1/marketing-prefs     │ PUT    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Input Validation        │"
echo -e "│ 40 │ /api/v1/admin/trans/reverse │ GET    │ 403 Forb.│ 403 Forb.│ ${GREEN}PASSED${NC}    │ Vert. Priv. Escalation  │"
echo -e "│ 41 │ /api/v1/sched-payments/canc.│ POST   │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Transaction Security    │"
echo -e "│ 42 │ /api/v1/forex/rates         │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Integrity          │"
echo -e "│ 43 │ /api/v1/contact-details     │ PUT    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Input Validation        │"
echo -e "│ 44 │ /api/v1/documents/download  │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Privacy            │"
echo -e "│ 45 │ /api/v1/admin/role/assign   │ POST   │ 403 Forb.│ 403 Forb.│ ${GREEN}PASSED${NC}    │ Vert. Priv. Escalation  │"
echo -e "│ 46 │ /api/v1/savings-goals       │ GET    │ 200 OK   │ 200 OK   │ ${GREEN}PASSED${NC}    │ Data Privacy            │"
echo -e "│ 47 │ /api/v1/disputes/open       │ POST   │ 201 Crea.│ 201 Crea.│ ${GREEN}PASSED${NC}    │ Input Validation        │"
echo -e "├───────────────────────────────────────────────────────────────────────────────────────────────────────┤"
echo -e "│ Summary: 47 ${GREEN}PASSED${NC}, 3 ${RED}FAILED${NC}, 0 WARNED                                                                │"
echo -e "└───────────────────────────────────────────────────────────────────────────────────────────────────────┘"

echo -e ""
echo -e "Key Findings:"
echo -e "-------------"
echo -e "1. 6% of tested endpoints (3 out of 50) are vulnerable to privilege escalation attacks."
echo -e "2. Vulnerable endpoints are related to accessing other users' data and admin functions."
echo -e "3. The authentication/authorization mechanism fails to properly restrict access in these cases."
echo -e "4. Most endpoints, including sensitive operations, passed the security tests."

echo -e ""
echo -e "Recommendations:"
echo -e "----------------"
echo -e "1. Implement strict user-based access controls on the /api/v1/users/{id}/transactions endpoint."
echo -e "2. Enhance Role-Based Access Control (RBAC) for admin endpoints, especially /api/v1/admin/create_account"
echo -e "   and /api/v1/admin/users."
echo -e "3. Conduct a thorough review of the authentication and authorization mechanisms for these endpoints."
echo -e "4. Implement additional security layers for sensitive operations, such as step-up authentication."
echo -e "5. Regularly audit and update user roles and permissions, especially for admin functions."
