#!/bin/bash

# ANSI color codes
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m' # No Color
BOLD='\033[1m'

# Header
echo "┌───────────────────────────────────────────────────────────────────────────────────────────────────────┐"
echo "│ AI-Driven API Pentesting Platform - Results                                                           │"
echo "├───────────────────────────────────────────────────────────────────────────────────────────────────────┤"
echo "│ Target: api.securebank.com                                                                            │"
echo "│ Pentest Run: 2023-04-15 09:45:30 UTC                                                                  │"
echo "├───────────────────────────────────────────────────────────────────────────────────────────────────────┤"
echo "│ ID │ Endpoint                    │ Method │ Original │ Modified │ Status    │ Test Type               │"
echo "├───────────────────────────────────────────────────────────────────────────────────────────────────────┤"

echo "│ 1  │ /api/v1/auth/login          │ POST   │ 200 OK   │ 200 OK   │ PASSED    │ Authentication          │"
echo "│ 2  │ /api/v1/users/me            │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Authenticated Access    │"
echo "│ 3  │ /api/v1/users/101/transact..│ GET    │ 403 Forb.│ 200 OK   │ FAILED    │ Horiz. Priv. Escalation │"
echo "│ 4  │ /api/v1/transfers           │ POST   │ 201 Crea.│ 201 Crea.│ PASSED    │ Transaction Security    │"
echo "│ 5  │ /api/v1/accounts/balance    │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Integrity          │"
echo "│ 6  │ /api/v1/admin/create_account│ POST   │ 403 Forb.│ 201 Crea.│ FAILED    │ Vert. Priv. Escalation  │"
echo "│ 7  │ /api/v1/transactions/recent │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Privacy            │"
echo "│ 8  │ /api/v1/users/me/update     │ PUT    │ 200 OK   │ 200 OK   │ PASSED    │ Input Validation        │"
echo "│ 9  │ /api/v1/cards/list          │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Enumeration        │"
echo "│ 10 │ /api/v1/admin/users         │ GET    │ 403 Forb.│ 200 OK   │ FAILED    │ Vert. Priv. Escalation  │"
echo "│ 11 │ /api/v1/payments/schedule   │ POST   │ 201 Crea.│ 201 Crea.│ PASSED    │ Transaction Security    │"
echo "│ 12 │ /api/v1/notifications       │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Privacy            │"
echo "│ 13 │ /api/v1/settings/update     │ PUT    │ 200 OK   │ 200 OK   │ PASSED    │ Input Validation        │"
echo "│ 14 │ /api/v1/investments/portfol.│ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Integrity          │"
echo "│ 15 │ /api/v1/admin/system/config │ POST   │ 403 Forb.│ 403 Forb.│ PASSED    │ Vert. Priv. Escalation  │"
echo "│ 16 │ /api/v1/loans/status        │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Privacy            │"
echo "│ 17 │ /api/v1/feedback            │ POST   │ 201 Crea.│ 201 Crea.│ PASSED    │ Input Validation        │"
echo "│ 18 │ /api/v1/branches/nearby     │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Enumeration        │"
echo "│ 19 │ /api/v1/profile/picture     │ PUT    │ 200 OK   │ 200 OK   │ PASSED    │ File Upload Security    │"
echo "│ 20 │ /api/v1/reports/annual      │ GET    │ 403 Forb.│ 403 Forb.│ PASSED    │ Vert. Priv. Escalation  │"
echo "│ 21 │ /api/v1/currency/exchange   │ POST   │ 201 Crea.│ 201 Crea.│ PASSED    │ Transaction Security    │"
echo "│ 22 │ /api/v1/statements/list     │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Privacy            │"
echo "│ 23 │ /api/v1/password/update     │ PUT    │ 200 OK   │ 200 OK   │ PASSED    │ Authentication          │"
echo "│ 24 │ /api/v1/promotions/active   │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Enumeration        │"
echo "│ 25 │ /api/v1/admin/announcements │ POST   │ 403 Forb.│ 403 Forb.│ PASSED    │ Vert. Priv. Escalation  │"
echo "│ 26 │ /api/v1/atms/locations      │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Enumeration        │"
echo "│ 27 │ /api/v1/support/ticket      │ POST   │ 201 Crea.│ 201 Crea.│ PASSED    │ Input Validation        │"
echo "│ 28 │ /api/v1/insurance/policies  │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Privacy            │"
echo "│ 29 │ /api/v1/notif/preferences   │ PUT    │ 200 OK   │ 200 OK   │ PASSED    │ Input Validation        │"
echo "│ 30 │ /api/v1/admin/logs          │ GET    │ 403 Forb.│ 403 Forb.│ PASSED    │ Vert. Priv. Escalation  │"
echo "│ 31 │ /api/v1/investments/trade   │ POST   │ 201 Crea.│ 201 Crea.│ PASSED    │ Transaction Security    │"
echo "│ 32 │ /api/v1/credit-score        │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Privacy            │"
echo "│ 33 │ /api/v1/account/nickname    │ PUT    │ 200 OK   │ 200 OK   │ PASSED    │ Input Validation        │"
echo "│ 34 │ /api/v1/rewards/points      │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Integrity          │"
echo "│ 35 │ /api/v1/admin/user/suspend  │ POST   │ 403 Forb.│ 403 Forb.│ PASSED    │ Vert. Priv. Escalation  │"
echo "│ 36 │ /api/v1/cards/limits        │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Privacy            │"
echo "│ 37 │ /api/v1/beneficiaries/add   │ POST   │ 201 Crea.│ 201 Crea.│ PASSED    │ Input Validation        │"
echo "│ 38 │ /api/v1/transactions/categ. │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Enumeration        │"
echo "│ 39 │ /api/v1/marketing-prefs     │ PUT    │ 200 OK   │ 200 OK   │ PASSED    │ Input Validation        │"
echo "│ 40 │ /api/v1/admin/trans/reverse │ GET    │ 403 Forb.│ 403 Forb.│ PASSED    │ Vert. Priv. Escalation  │"
echo "│ 41 │ /api/v1/sched-payments/canc.│ POST   │ 200 OK   │ 200 OK   │ PASSED    │ Transaction Security    │"
echo "│ 42 │ /api/v1/forex/rates         │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Integrity          │"
echo "│ 43 │ /api/v1/contact-details     │ PUT    │ 200 OK   │ 200 OK   │ PASSED    │ Input Validation        │"
echo "│ 44 │ /api/v1/documents/download  │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Privacy            │"
echo "│ 45 │ /api/v1/admin/role/assign   │ POST   │ 403 Forb.│ 403 Forb.│ PASSED    │ Vert. Priv. Escalation  │"
echo "│ 46 │ /api/v1/savings-goals       │ GET    │ 200 OK   │ 200 OK   │ PASSED    │ Data Privacy            │"
echo "│ 47 │ /api/v1/disputes/open       │ POST   │ 201 Crea.│ 201 Crea.│ PASSED    │ Input Validation        │"
echo "├───────────────────────────────────────────────────────────────────────────────────────────────────────┤"
echo "│ Summary: 47 PASSED, 3 FAILED, 0 WARNED                                                                │"
echo "└───────────────────────────────────────────────────────────────────────────────────────────────────────┘"

echo ""
echo "Key Findings:"
echo "-------------"
echo "1. 6% of tested endpoints (3 out of 50) are vulnerable to privilege escalation attacks."
echo "2. Vulnerable endpoints are related to accessing other users' data and admin functions."
echo "3. The authentication/authorization mechanism fails to properly restrict access in these cases."
echo "4. Most endpoints, including sensitive operations, passed the security tests."

echo ""
echo "Recommendations:"
echo "----------------"
echo "1. Implement strict user-based access controls on the /api/v1/users/{id}/transactions endpoint."
echo "2. Enhance Role-Based Access Control (RBAC) for admin endpoints, especially /api/v1/admin/create_account"
echo "   and /api/v1/admin/users."
echo "3. Conduct a thorough review of the authentication and authorization mechanisms for these endpoints."
echo "4. Implement additional security layers for sensitive operations, such as step-up authentication."
echo "5. Regularly audit and update user roles and permissions, especially for admin functions."
