#!/bin/bash

# ANSI color codes
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m' # No Color
BOLD='\033[1m'

echo -e "${BOLD}Running API Pentest...${NC}"
echo
echo -e "+-----------------------+------------------+---------------------------------------------+"
echo -e "| ${BOLD}Pentest Group${NC}        | ${BOLD}Status${NC}           | ${BOLD}Details${NC}                                     |"
echo -e "+-----------------------+------------------+---------------------------------------------+"

# Group: Authentication Checks
echo -e "| Authentication        | ${GREEN}✓ Passed${NC}         | Function: loginUser()                           |"
echo -e "|                       |                    | Method: POST /api/auth/login                  |"
echo -e "|                       |                    | Params: { username: 'user', password: '****' }|"
echo -e "|                       |                    | User: John Doe (Regular User)                |"
echo -e "+-----------------------+------------------+---------------------------------------------+"

# Group: Authorization Checks
echo -e "| Authorization         | ${RED}✗ Failed${NC}         | Function: accessManagerDashboard()              |"
echo -e "|                       |                    | Method: GET /app/manager                      |"
echo -e "|                       |                    | Params: { userId: '1' }                       |"
echo -e "|                       |                    | User: Jane Smith (USER role)                 |"
echo -e "+-----------------------+------------------+---------------------------------------------+"

# Group: Input Validation Checks
echo -e "| Input Validation      | ${GREEN}✓ Passed${NC}         | Function: createUser()                         |"
echo -e "|                       |                    | Method: POST /api/users                       |"
echo -e "|                       |                    | Params: { username: 'newuser', email: 'user@example.com' } |"
echo -e "|                       |                    | User: Admin User (ADMIN role)                 |"
echo -e "+-----------------------+------------------+---------------------------------------------+"

# Group: SQL Injection Checks
echo -e "| SQL Injection         | ${GREEN}✓ Passed${NC}         | Function: searchProducts()                     |"
echo -e "|                       |                    | Method: GET /api/products/search              |"
echo -e "|                       |                    | Params: { query: 'test' }                      |"
echo -e "|                       |                    | User: John Doe (Regular User)                |"
echo -e "+-----------------------+------------------+---------------------------------------------+"

echo

# Set GitHub output for vulnerability found
echo "VULNERABILITY_FOUND=true" >> $GITHUB_OUTPUT

echo -e "${RED}${BOLD}Vulnerability Details:${NC}"
echo -e "Improper authorization handling detected in API endpoint '/app/manager'"
echo -e "Unauthorized access to manager's dashboard possible."
echo
